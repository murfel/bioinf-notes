# Сборка генома

Короткие риды, 150-300 нуклеотидов, 10^6 - 10^9 прочтений (Иллюмина).

Геном человека - 3 млрд, бактериальный геном - 3 млн (10^6).

Сложности:
- тандемные повторы - длинные куски ТАТАТАТА, которые сложно выравнить
- ...

Два шага:
- assembly
- scaffolding

Ассемблинг выдаёт контиги - длинные участки 10^4-10^6.

Во время скаффолдинга из контиг хотим понять направление контиг и расставить континги.
Могут быть непокрытые участки между контигами по 1000 нуклеотидов.
Непокрытые участки идут от хитро склеенной и прочитанной ДНК (todo).

## Модельная задача 
Нет ошибок прочтений. Геном циклический (бактериальный).

https://neerc.ifmo.ru/wiki/index.php?title=%D0%93%D1%80%D0%B0%D1%84%D1%8B_%D0%B4%D0%B5_%D0%91%D1%80%D1%8E%D0%B8%D0%BD%D0%B0

### Строка де Брюина

Строка де Брюина - кратчайшая строка, содержащая в себе все возможные бинарные строки длины `k`
в качестве подстрок.

Худшая оценка - склеим все строчки вместе, длина `k 2^k`.

Улучшаем. Утверждается, что можем склеить, чтобы было перекрытие по `(k-1)`. 
Тогда длина строки `2^k + k - 1`. Если разрешить циклическое прочтение, то `2^k`.

```
00010...
000
 001
  010
   ...
```

### Идея 1 - Граф перекрытий
Построение такой строки. Построим граф перекрытий (Overlap graph).

- Вершины - k-меры.
- Рёбра - из каждой вершины по ребру в два суффикса без первого символа.

Утверждается, что можем построить гамильтонов путь (без доказательства),
но поиск пути - NP-трудная задача.

В итоге граф перекрытий для этой задачи использовать не будем, но он используется при сборке длинных прочтений.

### Граф де Брюина
- Вершины - все `(k-1)`-меры
- Рёбра - a -> b, где a - префикс k-мера, b - суффикс k-мера
- Ответ - кратчайший путь по всем рёбрам (Эйлеров путь / цикл)

**Теорема.** В ор. графе существует эйлеров цикл <=> для каждой вершины `v`, `indegree(v) = outdegree(v)`.


## Реальная задача
Возвращаемся к реальной задаче.
Риды дробим на k-меры длины k, k обычно половина рида или k=31. SPADES дробит на разные k = 51, 71, 91, 141.

Строим граф де Брюина. На каждом ребре пишем не только k-мер, 
но и сколько раз встречался этот k-мер в данных (покрытие ребра).


Глубина секвинирования - сколько прочтений покрывает каждую позицию в геноме. 
10х - неплохое покрытие, для изучения мутаций нужно больше.


Пример. Рид от иллюмины типично может иметь одну ошибку в конце. 

```
o --> o --> o --> o --> o --> o --> o
            2 \
               \   <- tip (низкое покрытие)
                o   
```

**Пузырь** - диплоидный организм, нужно сохранить оба варианта.
```
               30    28    29
               --> o --> o --> o 
  50    48   /                   \
o --> o --> o                     o -----> o
             \ 15    17    18    /
               --> o --> o --> o

```

**Нечётное k.** Обратно комплементарное AGCT будет AGCT. Если k нечётное, то средний символ всегда будет разным.

**Анонс.** Метагеномика - выбор k и статистический анализ k-мерного спектра.

## Длинные прочтения, Overlap Layout Consensus (OLC)

10^3-10^5 прочтений, 10^4-10^5 количество.

- Пересечём все пары прочтений, построим граф перекрытий (overlap graph).
- Теперь длина требуемоего перекрытия сильно меньше, обычно ~100-1000 нуклеотидов.
- Разрешаем ошибки в перекрытиях, обычно ~5%.

```
Read 1 --------------
Read 2      ---------------
Read 3          ----------------

r1 -> r2
r2 -> r3
r1 -> r3
```

Можем выкинуть ребро r1 -> r3.

Гибридная сборка.


